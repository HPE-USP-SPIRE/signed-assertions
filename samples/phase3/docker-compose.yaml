version: "3"

services:
  common:
    build:
      context: ../..
      dockerfile: samples/phase3/common/Dockerfile
    volumes:
      - /tmp/spire-agent/public/api.sock:/tmp/spire-agent/public/api.sock
    networks:
      - my-network

  assertingwl:
    build:
      context: ../..
      dockerfile: samples/phase3/Assertingwl-mTLS/Dockerfile
    ports:
      - "8443:8443"
      - "2113:2113"
    volumes:
      - /tmp/spire-agent/public/api.sock:/tmp/spire-agent/public/api.sock
    networks:
      - my-network

  subjectwl:
    build:
      context: ../..
      dockerfile: samples/phase3/subject_workload/Dockerfile
    ports:
      - "8080:8080"
      - "2110:2110"
    volumes:
      - /tmp/spire-agent/public/api.sock:/tmp/spire-agent/public/api.sock
    networks:
      - my-network

  m-tier:
    build:
      context: ../..
      dockerfile: samples/phase3/m-tier/Dockerfile
    ports:
      - "8445:8445"
      - "2115:2115"
    volumes:
      - /tmp/spire-agent/public/api.sock:/tmp/spire-agent/public/api.sock
    networks:
      - my-network

  target-wl:
    build:
      context: ../..
      dockerfile: samples/phase3/target-wl/Dockerfile
    ports:
      - "8444:8444"
      - "2114:2114"
    volumes:
      - /tmp/spire-agent/public/api.sock:/tmp/spire-agent/public/api.sock
    networks:
      - my-network

networks:
  my-network:
